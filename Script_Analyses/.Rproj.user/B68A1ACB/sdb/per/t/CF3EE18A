{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Evolution of Stress response in Aphaenogaster\"\nauthor: \"Andrew Nguyen\"\ndate: \"2015-August-25\"\noutput: pdf_document\n---\n\n#Methods: \nWe collected along a N-S transect from Florida to Maine and measured their stress response under a common garden experiment. In total, we sampled 27 unique sites and collected 74 colonies. To determine whetherWe measured the stress response quantifying the basal and induction gene expression patterns of three heat shock proteins (hsc70, hsp83, hsp40) for each colony. The degree of induction was measured as the relative fold increase of mildly heat treated (37C) compared to control treated(25C) ants. \n\nIn total, there were 64 colonies, 37 of which reared at 20C and 27 reared at 26C.\n\n\n```{r load libraries, echo=FALSE,include=FALSE}\nlibrary(plyr)\nlibrary(dplyr)\nlibrary(ape)\nlibrary(MASS)\nlibrary(ggplot2)\nlibrary(gridExtra)\nlibrary(raster)\nlibrary(rgdal) \nlibrary(dismo)\nlibrary(maptools)\nlibrary(mapdata)\n```\n#Data parsing\n```{r data parsing}\ndat<-read.csv(\"../Data/20150810_anbe_curated_dat_v3.csv\",skip=6) #xp data\ndat2<-read.csv(\"../Data/2015_JSG_phytotron_bioclim.csv\") # full data set with climate factors\n#changing factors into characters for Colony so I can merg em!\ndat$Colony<-as.factor(as.character(dat$Colony))\ndat2$Colony<-as.factor(as.character(dat2$Colony))\n\n#merging dat and dat2 so I can link up xp data with climate factors!\nmerg<-inner_join(dat2,dat,by=\"Colony\")\n#summary of data\ndim(merg) # dimensions of dataset\nsummary(merg$Species_2)# number of species\n\nsummary(as.factor(as.character(merg$Rearing_Temp)))#the number of colonies reared at 20 and 26\nknitr::kable(subset(merg,merg$Species_2==\"fulva\")[,1:14] )# just seeing what fulva looks like\n\n#reading in phylogenetic tree \n#jsg.tree<-read.tree(\"../Phylogenetics/20150824_JSG_phytotron_tree_BL_only_v2\")\njsg.tree<-read.tree(\"../Data/Phylogenetics/20150824_JSG_phytotron_tree_BL_only_v2\")\n#\"28-A\"\njsg.tree<-drop.tip(jsg.tree,tip=c(\"28-A\",\"11-C\",\"25-C\",\"07-B\",\"10-F\"))\nplot(jsg.tree)\nwrite.tree(jsg.tree,\"20161012_Hsp_modulation_phylogeny.newick\")\npcoa.jsg<-pcoa(cophenetic.phylo(jsg.tree))\nbiplot(pcoa.jsg) #viewing separation \n\n#setting as dataframe\nn.pcoa.jsg<-as.data.frame(pcoa.jsg$vectors[,1:4])\nn.pcoa.jsg$Colony<-jsg.tree$tip.label\ndim(n.pcoa.jsg)\n##making full dataset\nmerg<-inner_join(merg,n.pcoa.jsg,by=\"Colony\")\nnames(merg)\nnames(merg)[44:46]<-c(\"Axis.1\",\"Axis.2\",\"Axis.3\")\ndim(merg)# nice!!\nsummary(as.factor(as.character(merg$Rearing_Temp)))\nful<-subset(merg,merg$Species_2==\"fulva\")\n\nddply(merg,.(Site),summarize,count=length(Colony))#counts of colonies at each site\nplot(merg$Axis.1,merg$Axis.2,xlim=c(-.15,.25),ylim=c(-.25,.1),type=\"n\",xlab=\"Axis 1\",ylab=\"Axis 2\")\ntext(merg$Axis.1,merg$Axis.2,labels=merg$Tree_site)\n\nplot(merg$Axis.2,merg$Axis.3,type=\"n\",xlab=\"Axis 2\",ylab=\"Axis 3\",xlim=c(-.05,.1))\ntext(merg$Axis.2,merg$Axis.3,labels=merg$Tree_site)\n\n```\n\n#checking axes\n```{r checking axes}\n#phylo.70.1<-lm(log10(merg$FC_70)~merg$Axis.1)\n#hist(resid(phylo.70.1),xlim=c(-.8,.8))\n\n\nphylo.70.2<-lm(log10(merg$FC_70)~merg$Axis.1+merg$Axis.2)\nhist(resid(phylo.70.2),xlim=c(-.8,.8))\n\nphylo.70.3<-lm(log10(merg$FC_70)~merg$Axis.1+merg$Axis.2+merg$Axis.3)\nhist(resid(phylo.70.3))\n\n```\n\n#Stats: Using forward selection\nresponse: basal or induction gene xp--log10 transformed to meet the assumptions of normality\npredictors: rearing temp, Tmax(bio5)\n```{r forward model selection}\n#applying a regression model across columns\n#response: basal or induction gene xp\n#predictors: rearing temp, bio1(MAT), phylo axes\n\n#with Tmax\napply(merg[,38:43],2,function(x){summary(stepAIC(lm(log10(x)~merg$bio5+merg$Rearing_Temp+merg$Axis.1+merg$Axis.2+merg$Axis.3)),direction=\"forward\")})\n\n#with MAT\napply(merg[,38:43],2,function(x){summary(stepAIC(lm(log10(x)~merg$bio1+merg$Rearing_Temp+merg$Axis.1+merg$Axis.2+merg$Axis.3)),direction=\"forward\")})\n\n#with no phylo axes 1\napply(merg[,38:43],2,function(x){summary(stepAIC(lm(log10(x)~merg$bio5+merg$Rearing_Temp+merg$Axis.2+merg$Axis.3)),direction=\"forward\")})\n```\n\n#Expression Figures for rearing temp\n```{r rearing temp figures}\n#theme########################################\nT<-theme_bw()+theme(text=element_text(size=30),axis.text=element_text(size=30),legend.text=element_text(size=28),panel.grid.major=element_blank(),panel.grid.minor.x = element_blank(),panel.grid = element_blank(),legend.key = element_blank())\n\ndude<-scale_fill_manual(name = \"\", values = c(\"gray\", \"goldenrod\"))\n#color\n##################################################\n#####ggplot of hsp83 basal\n#add notches: geom_boxplot(notch=TRUE)\nbasal_83<-ggplot(data=merg,aes(x=factor(Rearing_Temp),y=B_83,fill=factor(Rearing_Temp)))+geom_boxplot()+T+ylab(expression(paste(\"Hsp83 basal expression (\",2^paste(Delta,Delta,\"CT\"),\")\")))+scale_y_continuous(limits=c(0,7),breaks=seq(0,7,1))+xlab(\"\")+dude+guides(fill=FALSE)\n\n#+xlab(\"Maintenance Temperature (°C)\")\nbasal_83\n\n#####ggplot of hsp70 basal\nbasal_70<-ggplot(data=merg,aes(x=factor(Rearing_Temp),y=B_70,fill=factor(Rearing_Temp)))+geom_boxplot()+T+ylab(expression(paste(\"Hsp70 basal expression (\",2^paste(Delta,Delta,\"CT\"),\")\")))+scale_y_continuous(limits=c(0,8),breaks=seq(0,8,2))+xlab(\"\")+dude+guides(fill=FALSE)\n#+xlab(\"Maintenance Temperature (°C)\")\nbasal_70\n#####ggplot of hsp40 basal\nbasal_40<-ggplot(data=merg,aes(x=factor(Rearing_Temp),y=B_40,fill=factor(Rearing_Temp)))+geom_boxplot()+ylab(expression(paste(\"Hsp40 basal expression (\",2^paste(Delta,Delta,\"CT\"),\")\")))+scale_y_continuous(limits=c(0,11),breaks=seq(0,11,1))+T+xlab(\"\")+dude+guides(fill=FALSE)+xlab(\"Acclimation Temperature (°C)\")\n#+xlab(\"Maintenance Temperature (°C)\")+\nbasal_40\n\n#####ggplot of hsp83 induction\ninduc_hsp83<-ggplot(data=merg,aes(x=factor(Rearing_Temp),y=FC_83,fill=factor(Rearing_Temp)))+geom_boxplot()+T+xlab(\"\")+ylab(expression(paste(\"Hsp83 induction (\",2^paste(Delta,Delta,\"CT\"),\")\")))+dude+guides(fill=FALSE)\ninduc_hsp83\n\n#####ggplot of hsp70 induction\ninduc_hsp70<-ggplot(data=merg,aes(x=factor(Rearing_Temp),y=FC_70,fill=factor(Rearing_Temp)))+geom_boxplot()+T+xlab(\"\")+ylab(expression(paste(\"Hsp70 induction (\",2^paste(Delta,Delta,\"CT\"),\")\")))+dude+guides(fill=FALSE)\ninduc_hsp70\n#####ggplot of hsp70 induction\n#####ggplot of hsp40 induction\ninduc_hsp40<-ggplot(data=merg,aes(x=factor(Rearing_Temp),y=FC_40,fill=factor(Rearing_Temp)))+geom_boxplot()+T+xlab(\"Acclimation Temperature (°C)\")+ylab(expression(paste(\"Hsp40 induction (\",2^paste(Delta,Delta,\"CT\"),\")\")))+T+dude+guides(fill=FALSE)\ninduc_hsp40\n#+scale_y_continuous(limits=c(0,8),breaks=seq(0,8,2))\n\n\n#grid.arrange(basal_83,basal_70,basal_40,induc_hsp83,induc_hsp70,induc_hsp40,nrow=2,ncol=3)\n\ngrid.arrange(basal_83,induc_hsp83,basal_70,induc_hsp70,basal_40,induc_hsp40,nrow=3,ncol=2)\n\n```\n#Expression figures against Tmax\n```{r expression figs against Tmax}\nT<-theme_bw()+theme(text=element_text(size=30),axis.text=element_text(size=30),legend.text=element_text(size=28),panel.grid.major=element_blank(),legend.position=\"none\",panel.grid.minor.x = element_blank(),panel.grid = element_blank(),legend.key = element_blank())\n#loess fit\n#loess<-stat_smooth(colour=\"red\",geom=\"smooth\",method=\"auto\",se=FALSE,size=3)\nloess<-stat_smooth(colour=\"red\",method=\"loess\",span=1)\n#merg$bio5<-merg$bio5/10\n\n######hsp83 basal###############\nT83<-ggplot(data=merg,aes(x=bio5/10,y=B_83))+geom_point(size=5)+T+ylab(expression(paste(\"Hsp83 basal expression (\",2^paste(\"-\",Delta,Delta,\"CT\"),\")\")))+scale_y_continuous(limits=c(0,7),breaks=seq(0,7,1))+xlab(\"\")\n#+loess\nT83\n\n######hsp70 basal###############\nT70<-ggplot(data=merg,aes(x=bio5/10,y=B_70))+geom_point(size=5)+T+ylab(expression(paste(\"Hsp70 basal expression (\",2^paste(\"-\",Delta,Delta,\"CT\"),\")\")))+scale_y_continuous(limits=c(0,7),breaks=seq(0,7,1))+xlab(\"\")\n#+loess\nT70\n\n######hsp40 basal###############\n#merg$bio5<-merg$bio5/10\nT40<-ggplot(data=merg,aes(x=bio5/10,y=B_40))+geom_point(size=5)+T+ylab(expression(paste(\"Hsp40 basal expression (\",2^paste(\"-\",Delta,Delta,\"CT\"),\")\")))+scale_y_continuous(limits=c(0,11),breaks=seq(0,11,1))+xlab(\"Tmax (°C)\")\n#+loess\nT40\n\n#####################\n######hsp83 induction###############\nT83ind<-ggplot(data=merg,aes(x=bio5/10,y=FC_83))+geom_point(size=5)+T+ylab(expression(paste(\"Hsp83 induction (\",2^paste(\"-\",Delta,Delta,\"CT\"),\")\")))+scale_y_continuous(limits=c(0,44),breaks=seq(0,44,4))+xlab(\"\")\n#+loess\nT83ind\n\n######hsp70 induction###############\nT70ind<-ggplot(data=merg,aes(x=bio5/10,y=FC_70,))+geom_point(size=5)+T+ylab(expression(paste(\"Hsp70 induction (\",2^paste(\"-\",Delta,Delta,\"CT\"),\")\")))+scale_y_continuous(limits=c(10,120),breaks=seq(10,120,10))+xlab(\"\")\n#+loess\nT70ind\n\n######hsp40 induction###############\nT40ind<-ggplot(data=merg,aes(x=bio5/10,y=FC_40))+geom_point(size=5)+T+ylab(expression(paste(\"Hsp40 induction (\",2^paste(\"-\",Delta,Delta,\"CT\"),\")\")))+scale_y_continuous(limits=c(0,44),breaks=seq(0,44,4))+xlab(\"Tmax (°C)\")\n#+loess\nT40ind\n\n#grid.arrange(T83,T70,T40,T83ind,T70ind,T40ind,nrow=2,ncol=3)\ngrid.arrange(T83,T70,T40,nrow=3)\ngrid.arrange(T83ind,T70ind,T40ind,nrow=3)\n```\n\n\n#making maps for a talk\n##field collections site map\n```{r,eval=FALSE}\nw <- getData('worldclim', var='bio', res=2.5)\n\nplot(w, 5, xlim=c(-87,-65), ylim=c(30,48), axes=F, legend=T, col=colorRampPalette(c(\"skyblue\",\"white\"))(255),main=\"\",box=FALSE)\n#map(\"world\",c(\"USA\",\"Canada\"),add=TRUE)\nmap(\"state\", c('florida', 'south carolina', 'north carolina', 'georgia', 'virginia', 'west virginia', 'maryland', 'delaware', 'new jersey', 'rhode island', 'new york', 'connecticut', 'massachusetts', 'pennyslvania', 'vermont', 'new hampshire', 'maine', 'alabama', 'tennessee', 'kentucky', 'ohio','iowa','illinois','arkansas','missouri','minnesota','wisconsin','michigan','louisiana','mississippi',\"texas\",\"arizona\",\"illinois\",\"california\",\"oregon\",\"utah\",\"washington\",\"kansas\",\"new mexico\",\"montana\",\"idaho\",\"wyoming\",\"north dakota\",\"south dakota\",\"nebraska\",\"oklahoma\"), add = TRUE)\nrect(-150,25,-55,5,col=\"white\",border=\"white\")\nrect(-65,50,-50,25,col=\"white\",border=\"white\")\nrect(-87,50,-100,25,col=\"white\",border=\"white\")\nbb8<-read.csv(\"../Data/20160219_site_for_map_excludingsome_v2.csv\")\ncolm<-ifelse(merg$Axis.1>.17,\"#D55E00\",\"#0072B2\")\npoints(merg$lon.2,merg$lat,pch=20,col=colm,cex=1.75)\n#points(bb8$lon.2,bb8$lat,pch=20,cex=1.5)\ntext(bb8$lon.3,bb8$lat+.4,labels=bb8$Site_2,cex=.75,font=2)\n#plotting points with the size related to thermal niche breadth\n#add color by species\n#http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/#a-colorblind-friendly-palette\n\n\n\n#text(merg$lon.2,merg$lat+.5,labels=merg$Site_2,cex=.75)\n\n\n\n\n```\n\n\n```{r}\ncpsit<-ddply(merg,.(Site_2),summarize,Longitude=mean(lon.2),Latitude=mean(lat),Tmax=mean(bio5))\nhead(cpsit)\ndim(cpsit)\n\ncpsit\nnew<-cpsit[order(cpsit$Tmax),]\nnew\n\n#write.csv(new,\"Sampling_sites_table.csv\")\n\n```\n\n#20160825_sampling map\n```{r,eval=FALSE}\nfgl<-read.csv(\"20160825_final_dataset_HSP_modulation.csv\")\nfgl$tree_color<-as.character(fgl$tree_color)\n\n\nplot(w, 5, xlim=c(-87,-65), ylim=c(30,48), axes=FALSE, legend=FALSE, col=colorRampPalette(c(\"skyblue\",\"white\"))(255),main=\"\",box=FALSE)\n#map(\"world\",c(\"USA\",\"Canada\"),add=TRUE)\nmap(\"state\", c('florida', 'south carolina', 'north carolina', 'georgia', 'virginia', 'west virginia', 'maryland', 'delaware', 'new jersey', 'rhode island', 'new york', 'connecticut', 'massachusetts', 'pennyslvania', 'vermont', 'new hampshire', 'maine', 'alabama', 'tennessee', 'kentucky', 'ohio','iowa','illinois','arkansas','missouri','minnesota','wisconsin','michigan','louisiana','mississippi',\"texas\",\"arizona\",\"illinois\",\"california\",\"oregon\",\"utah\",\"washington\",\"kansas\",\"new mexico\",\"montana\",\"idaho\",\"wyoming\",\"north dakota\",\"south dakota\",\"nebraska\",\"oklahoma\"), add = TRUE)\nmap('lakes', add=TRUE, fill=TRUE, col='white', boundary='black')\nrect(-150,25,-55,5,col=\"white\",border=\"white\")\nrect(-65,50,-50,25,col=\"white\",border=\"white\")\nrect(-87,50,-100,25,col=\"white\",border=\"white\")\n\npoints(fgl$lon.2,fgl$lat,col=fgl$tree_color,pch=fgl$pch)\n#la<-subset(bb8,bb8$Site==\"LA\")\npoints(-79.181,37.4211,pch=19,col=\"blue\")\n#text(fgl$lon.3,fgl$lat+.4,labels=fgl$Site_2,cex=.75,font=2)\ntext(bb8$lon.3,bb8$lat+.4,labels=bb8$Site_2,cex=.75,font=2)\n\n```\n\n```{r Sessioninfo}\nsessionInfo()\n```\n\n",
    "created" : 1476301374267.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "75|20|86|0|\n197|17|222|0|\n225|6|236|0|\n239|17|258|0|\n",
    "hash" : "3899415302",
    "id" : "CF3EE18A",
    "lastKnownWriteTime" : 1478355642,
    "last_content_update" : 1478355684498,
    "path" : "~/zScience/Side_projects/HelmsCahan_CBP-partA_2016/Script_Analyses/20150810_Evolution_of_Stress_updated_V4.Rmd",
    "project_path" : "20150810_Evolution_of_Stress_updated_V4.Rmd",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}